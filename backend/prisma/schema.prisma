// This is your Prisma schema file
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // Can be changed to "mysql" or "sqlite"
  url      = env("DATABASE_URL")
}

enum UserRole {
  PATIENT
  ADMIN
  SUPER_ADMIN
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum NotificationPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  password      String
  role          UserRole       @default(PATIENT)
  name          String
  phone         String?
  state         String?
  localGov      String?
  isActive      Boolean        @default(true)
  isVerified    Boolean        @default(false)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  
  // Relations
  patient       Patient?
  appointments  Appointment[]
  notifications Notification[]
  payments      Payment[]
  
  @@map("users")
}

model Patient {
  id              String         @id @default(uuid())
  userId          String         @unique
  dateOfBirth     DateTime?
  gender          String?
  address         String?
  emergencyContact String?
  bloodGroup      String?
  allergies       String[]
  chronicConditions String[]
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  
  // Relations
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  healthRecords   HealthRecord[]
  prescriptions   Prescription[]
  labResults      LabResult[]
  documents       Document[]
  
  @@map("patients")
}

model Doctor {
  id              String         @id @default(uuid())
  name            String
  email           String         @unique
  phone           String
  specialty       String
  qualification   String
  experience      Int
  consultationFee Float
  clinic          String
  clinicAddress   String
  rating          Float          @default(0)
  totalReviews    Int            @default(0)
  isAvailable     Boolean        @default(true)
  bio             String?
  imageUrl        String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  
  // Relations
  appointments    Appointment[]
  availability    DoctorAvailability[]
  
  @@map("doctors")
}

model DoctorAvailability {
  id          String   @id @default(uuid())
  doctorId    String
  dayOfWeek   Int      // 0-6 (Sunday-Saturday)
  startTime   String   // HH:mm format
  endTime     String   // HH:mm format
  isAvailable Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  doctor      Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  
  @@map("doctor_availability")
}

model Appointment {
  id          String            @id @default(uuid())
  userId      String
  doctorId    String
  date        DateTime
  time        String
  status      AppointmentStatus @default(PENDING)
  notes       String?
  cancelReason String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  
  // Relations
  user        User              @relation(fields: [userId], references: [id])
  doctor      Doctor            @relation(fields: [doctorId], references: [id])
  payment     Payment?
  
  @@map("appointments")
}

model Payment {
  id              String        @id @default(uuid())
  userId          String
  appointmentId   String        @unique
  amount          Float
  adminFee        Float
  clinicAmount    Float
  status          PaymentStatus @default(PENDING)
  paymentMethod   String?
  transactionId   String?       @unique
  paymentGateway  String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  // Relations
  user            User          @relation(fields: [userId], references: [id])
  appointment     Appointment   @relation(fields: [appointmentId], references: [id])
  
  @@map("payments")
}

model HealthRecord {
  id          String   @id @default(uuid())
  patientId   String
  recordType  String   // vital_signs, diagnosis, treatment, etc.
  title       String
  description String
  recordDate  DateTime
  metadata    Json?    // Flexible JSON for different record types
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  patient     Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  
  @@map("health_records")
}

model Prescription {
  id          String   @id @default(uuid())
  patientId   String
  medication  String
  dosage      String
  frequency   String
  duration    String
  prescribedBy String
  prescribedDate DateTime
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  patient     Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  
  @@map("prescriptions")
}

model LabResult {
  id          String   @id @default(uuid())
  patientId   String
  testName    String
  testDate    DateTime
  result      String
  normalRange String?
  status      String   // normal, abnormal, critical
  fileUrl     String?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  patient     Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  
  @@map("lab_results")
}

model Document {
  id          String   @id @default(uuid())
  patientId   String
  title       String
  description String?
  fileUrl     String
  fileType    String
  fileSize    Int
  uploadDate  DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  patient     Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  
  @@map("documents")
}

model Notification {
  id          String               @id @default(uuid())
  userId      String
  title       String
  message     String
  type        String               // appointment, payment, health_record, system
  priority    NotificationPriority @default(MEDIUM)
  isRead      Boolean              @default(false)
  actionUrl   String?
  metadata    Json?
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  
  // Relations
  user        User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("notifications")
}

model AuditLog {
  id          String   @id @default(uuid())
  userId      String?
  action      String
  entity      String
  entityId    String?
  details     Json?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())
  
  @@map("audit_logs")
}
